/*! perspective-view - Delivers a simple javascript methods pool for rendering grid based (array) maps into a virtual, perspective, 3d top view with canvas. - Version: 1.3.2 */
function PerspectiveView(a){return window.PPV.init(a)}function isArray(a){return"[object Array]"==Object.prototype.toString.call(a)}function isUndefined(a){return"[object Undefined]"==Object.prototype.toString.call(a)}function isNull(a){return"[object Null]"==Object.prototype.toString.call(a)}function isString(a){return"[object String]"==Object.prototype.toString.call(a)}function isNumber(a){return"[object Number]"==Object.prototype.toString.call(a)}function isBoolean(a){return"[object Boolean]"==Object.prototype.toString.call(a)}function isObject(a){return"[object Object]"==Object.prototype.toString.call(a)}function isFunction(a){return"[object Function]"==Object.prototype.toString.call(a)}window.PPV=function(){"use strict";function a(a){var b;if(j.enable&&(!a||"object"!=typeof a)&&(console.error("Parameter <module> is not a valid PerspectiveView module :: ","{",typeof a,"} :: ",a),j.abortOnError))throw new Error("Script abort");for(b in a)a.hasOwnProperty(b)&&h.hasOwnProperty(b)?console.error("There already exists a module named '"+b+"'"):h[b]=a[b]}function b(a){var b;for(b in h)h.hasOwnProperty(b)&&"function"==typeof h[b].init&&h[b].init(a)}function c(){var a;for(a in h)h.hasOwnProperty(a)&&"function"==typeof h[a].run&&h[a].run()}function d(a){var b;for(b in h)h.hasOwnProperty(b)&&"function"==typeof h[b].update&&h[b].update(a)}function e(a){return i=h.merge.deep(k,a),"default"===i.color.mode.toLowerCase()&&(i.colorModule="color"),b(i),c(),{render:f,update:g}}function f(){h.render.render()}function g(a){i=h.merge.deep(i,a),d(i)}var h={},i={},j={enable:!0,abortOnError:!1,util:{}},k={colorModule:{},canvas:null,context:null,map:[[1]],unitSize:100,unitDepth:1.1,position:{x:0,y:0},camera:{width:800,height:600,position:{x:400,y:300}},render:{mode:"normal",wireFrame:!1,grid:!1,camera:!1},color:{mode:"default",objectColor:{r:200,g:200,b:200,a:1},spaceColor:{r:255,g:255,b:255,a:0},lighting:{base:0,east:-10,height:2,front:10,north:-20,south:0,west:-15}}};return{DEV:j,configuration:i,appendModule:a,init:e,modules:h}}(),function(a){"use strict";function b(a){c(a)}function c(a){k=a.canvas,j=a.context}function d(){j.save(),j.setTransform(1,0,0,1,0,0),j.clearRect(0,0,k.width,k.height),j.restore()}function e(a){var b={x:a.position.x,y:a.position.y},c={x:b.x-a.width/2,y:b.y-a.height/2},d={x:b.x+a.width/2,y:b.y-a.height/2},e={x:b.x-a.width/2,y:b.y+a.height/2},f={x:b.x+a.width/2,y:b.y+a.height/2};j.save(),j.strokeStyle=l.camera.color,j.lineWidth=l.camera.lineWidth,j.rect(c.x,c.y,a.width,a.height),j.stroke(),j.beginPath(),j.moveTo(c.x,c.y),j.lineTo(b.x,b.y),j.stroke(),j.beginPath(),j.moveTo(d.x,d.y),j.lineTo(b.x,b.y),j.stroke(),j.beginPath(),j.moveTo(f.x,f.y),j.lineTo(b.x,b.y),j.stroke(),j.beginPath(),j.moveTo(e.x,e.y),j.lineTo(b.x,b.y),j.stroke(),j.restore()}function f(a,b,c){var d,e,f=a.position.x%b-c.x,g=a.position.y%b-c.y;for(j.save(),j.strokeStyle=l.grid.color,j.lineWidth=l.grid.lineWidth,j.beginPath(),d=f;d<=k.width;d+=b)j.moveTo(d,0),j.lineTo(d,k.height);for(e=g;e<=k.height;e+=b)j.moveTo(0,e),j.lineTo(k.width,e);j.closePath(),j.stroke(),j.restore()}function g(a,b,c){var d,e,f=a.position.x-a.width/2,g=a.position.y-a.height/2,h=f+(f%b.width+b.width-c.x)%b.width,i=f+a.width,k=g+(g%b.height+b.height-c.y)%b.height,m=g+a.height;for(j.save(),j.strokeStyle=l.grid.color,j.lineWidth=l.grid.lineWidth,j.beginPath(),d=h;d<=i;d+=b.width)j.moveTo(d,g),j.lineTo(d,m);for(e=k;e<=m;e+=b.height)j.moveTo(f,e),j.lineTo(i,e);j.closePath(),j.stroke(),j.restore()}function h(a,b,c,d){"number"!=typeof c&&(c=l.point.width),"number"!=typeof d&&(d=l.point.height),j.save(),j.fillStyle=l.point.color,j.fillRect(a-c/2,b-d/2,c,d),j.restore()}function i(a){var b,c=a.path,d=a.filled||!1,e=c.length;for(j.save(),j.strokeStyle=l.path.color,j.fillStyle=l.path.fillcolor,j.lineWidth=l.path.lineWidth,j.beginPath(),j.moveTo(c[0].x,c[0].y),b=1;b<e;b++)j.lineTo(c[b].x,c[b].y);j.closePath(),j.stroke(),d||j.fill(),j.restore()}var j={},k={},l={camera:{color:"rgba(0, 255, 127, 0.5)",lineWidth:1},grid:{color:"rgba(0, 127, 255, 0.5)",lineWidth:1},path:{color:"rgba(255, 0, 127, 0.5)",fillcolor:"#fff",lineWidth:1},point:{color:"rgba(255, 127, 0, 0.5)",width:5,height:5}};a.appendModule({canvasHelper:{init:b,clean:d,drawCamera:e,drawCanvasGrid:f,drawCameraGrid:g,drawPoint:h,drawPath:i}})}(window.PPV),function(a){"use strict";function b(a){d(a)}function c(){}function d(a){}function e(a,b){var c=Array.isArray(b),d=c&&[]||{};return c?(a=a||[],d=d.concat(a),b.forEach(function(b,c){"undefined"==typeof d[c]?d[c]=b:"object"==typeof b?d[c]=e(a[c],b):a.indexOf(b)===-1&&d.push(b)})):(a&&"object"==typeof a&&Object.keys(a).forEach(function(b){d[b]=a[b]}),Object.keys(b).forEach(function(c){"object"==typeof b[c]&&b[c]&&a[c]?d[c]=e(a[c],b[c]):d[c]=b[c]})),d}a.appendModule({merge:{init:b,run:c,update:d,deep:e}})}(window.PPV),function(a){"use strict";function b(a){d(a)}function c(){}function d(a){m=a}function e(a){var b=m.color.objectColor;return"rgba("+Math.round(b.r+2.55*a)+", "+Math.round(b.g+2.55*a)+", "+Math.round(b.b+2.55*a)+", "+b.a+")"}function f(){var a=m.color.lighting.base;return e(a)}function g(){var a=m.color.lightingColor.spaceColor;return"rgba("+a.r+", "+a.g+", "+a.b+", "+a.a+")"}function h(a){var b=m.color.lighting.front+a*m.color.lighting.height;return e(b)}function i(){var a=m.color.lighting.north;return e(a)}function j(){var a=m.color.lighting.east;return e(a)}function k(){var a=m.color.lighting.south;return e(a)}function l(){var a=m.color.lighting.west;return e(a)}var m={};a.appendModule({color:{init:b,run:c,update:d,getBase:f,getEast:j,getFront:h,getNorth:i,getSouth:k,getSpace:g,getWest:l}})}(window.PPV),function a(b){"use strict";function c(a){e(a)}function d(){}function e(b){k=b,a=b.map,n=g(),o=i(),m=h(n),p=j(o)}function f(b,c){var d,e,f,g,h=k.camera,i=k.unitSize,m=j(b),n=Math.ceil(h.width/2/i),o=Math.ceil(h.height/2/i),p=m.x-n-c,r=m.x+n+c,s=m.y-o-c,t=m.y+o+c;for(g=s,e=0;g<=t;g++,e++)for(l[e]=[],f=p,d=0;f<=r;f++,d++)g<0||f<0||g>=a.length||f>=a[0].length?l[e][d]=q.mapItem:l[e][d]=a[g][f];return l}function g(){return{x:a[0].length,y:a.length}}function h(a){return{x:k.unitSize*a.x,y:k.unitSize*a.y}}function i(){return{x:k.position.x,y:k.position.y}}function j(a){return{x:Math.floor(a.x/k.unitSize),y:Math.floor(a.y/k.unitSize)}}var k={},a=[],l=[],m={x:0,y:0},n={x:0,y:0},o={x:0,y:0},p={x:0,y:0},q={mapItem:0};b.appendModule({map:{init:c,run:d,update:e,getArea:f,getDimension:g,getPosition:i,getSize:h,getPositionTile:j}})}(window.PPV),function b(a){"use strict";function c(b){r=a.modules.map,s=a.modules[b.colorModule],t=a.modules.canvasHelper,e(b)}function d(){}function e(a){u=a,v=r.getArea(u.position,x),w=l(v)}function f(){u.context.save(),u.context.setTransform(1,0,0,1,0,0),u.context.clearRect(0,0,u.canvas.width,u.canvas.height),u.context.restore()}function g(){return{x:Math.floor(v[0].length/2),y:Math.floor(v.length/2)}}function h(a){var b=u.position,c=u.unitSize,d=i(a),e={x:b.x%c,y:b.y%c};return 0==a?e:{x:Math.round(e.x+(d-c)/(c/e.x)),y:Math.round(e.y+(d-c)/(c/e.y))}}function i(a){var b=u.unitSize,c=u.unitDepth;return 0==a?b:Math.round(b+Math.round(b*c-b)*a)}function b(){var a,b,c,d,e=u.camera,g=w.length;for(f(),b=g-1;b>=0;b--)c=w[b].x,d=w[b].y,a=v[d][c],"flat"===u.render.mode.toLowerCase()?(isNumber(a)&&a>0||isArray(a))&&k(m(c,d,0),s.getFront(0)):"uniform"===u.render.mode.toLowerCase()?(isNumber(a)&&a>0||isArray(a))&&j(c,d,0,1):isNumber(a)&&a>0?j(c,d,0,a):isArray(a)&&a.length>=2&&j(c,d,a[0],a[1]);if(u.render.grid){var l=h(0),n=i(0);t.drawCanvasGrid(e,n,l)}u.render.camera&&t.drawCamera(e)}function j(a,b,c,d){var e,f,h,i,j,l,r=g();e=m(a,b,c),f=m(a,b,d),(u.render.wireFrame||a<r.x)&&(h=o(e,f),k(h,s.getEast())),(u.render.wireFrame||a>r.x)&&(i=q(e,f),k(i,s.getWest())),(u.render.wireFrame||b<r.y)&&(j=p(e,f),k(j,s.getSouth())),(u.render.wireFrame||b>r.y)&&(l=n(e,f),k(l,s.getNorth())),k(f,s.getFront(d))}function k(a,b){var c=0;for(u.context.beginPath(),u.context.moveTo(a[c].x,a[c].y),u.context.fillStyle=b,u.context.strokeStyle=b,c=1;c<a.length;c++)u.context.lineTo(a[c].x,a[c].y);u.context.closePath(),u.context.stroke(),u.render.wireFrame||u.context.fill()}function l(a){var b,c,d=g(),e=a[0].length,f=a.length,h=[],i=[],j=[];for(b=d.x;b<e;b++)h.push(b);for(b=d.x-1;b>=0;b--)h.push(b);for(c=d.y;c<f;c++)i.push(c);for(c=d.y-1;c>=0;c--)i.push(c);for(c=0;c<f;c++)for(b=0;b<e;b++)j.push({x:h[b],y:i[c]});return j}function m(a,b,c){var d=g(),e=h(c),f=i(c),j=u.camera.position,k=e.x,l=e.y,m=j.x+(a-d.x)*f-k,n=j.y+(b-d.y)*f-l,o=m+f,p=n+f;return[{x:m,y:n},{x:o,y:n},{x:o,y:p},{x:m,y:p}]}function n(a,b){return[{x:a[0].x,y:a[0].y},{x:a[1].x,y:a[1].y},{x:b[1].x,y:b[1].y},{x:b[0].x,y:b[0].y}]}function o(a,b){return[{x:b[1].x,y:b[1].y},{x:a[1].x,y:a[1].y},{x:a[2].x,y:a[2].y},{x:b[2].x,y:b[2].y}]}function p(a,b){return[{x:b[3].x,y:b[3].y},{x:a[3].x,y:a[3].y},{x:a[2].x,y:a[2].y},{x:b[2].x,y:b[2].y}]}function q(a,b){return[{x:b[0].x,y:b[0].y},{x:a[0].x,y:a[0].y},{x:a[3].x,y:a[3].y},{x:b[3].x,y:b[3].y}]}var r=null,s=null,t=null,u={},v=[],w=[],x=0;a.appendModule({render:{init:c,run:d,update:e,render:b}})}(window.PPV);